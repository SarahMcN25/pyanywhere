<!-- This file contains a html webpage that can consume an API by performing CRUD operations -->
<!-- Author: Sarah McNelis - G00398343 -->

<html>
	<head>
		<title>Arrivals</title>

		<!-- Ajax -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

		<!-- Bootstrap -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

		<!-- JavaScript Bundle with Popper -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
		
		
	</head>
	
	<body>

		<!-- Pic -->
		<div align="center">
			<img src="snnairport.jpeg" alt="Shannon Airport Logo" width="450" height="250">
		</div>
		
		<!-- ACCORDION -->
		<div class="accordion" id="accordionPanelsStayOpenExample">

			<!-- GET ALL -->
			<div class="accordion-item">
				<h1 class="accordion-header" id="panelsStayOpen-headingOne">
					<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne" >
					View Arrivals
					</button>
				</h1>
				<div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
					<div class="accordion-body" id="div">
						<h2>Arrivals at Shannon Airport</h2>
						<table border="2" class="table table-hover" id="bookTable">
			
							<tr>
								
								<th>ID</th>
								<th>Airline</th> 
								<th>Origin</th>
								<th>Destination</th>
								<th>Flight Number</th>
								
							</tr>
							
							<tr id="1">
							
								<td>1</td>
								<td>AerLingus</td>
								<td>JFK</td>
								<td>SNN</td>
								<td>EI110</td>

							</tr>
							
							<tr id="2">
								
								<td>2</td>
								<td>Ryanair</td>
								<td>STN</td>
								<td>SNN</td>
								<td>FR310</td>

							</tr>
							
							<tr id="3">
							
								<td>3</td>
								<td>AerLingus</td>
								<td>LHR</td>
								<td>SNN</td>
								<td>EI381</td>

							</tr>
							
							<tr id="4">
							
								<td>4</td>
								<td>Air Canada</td>
								<td>YYZ</td>
								<td>SNN</td>
								<td>AC856</td>

							</tr>
							
							<tr id="5">
							
								<td>5</td>
								<td>Ryanair</td>
								<td>LGW</td>
								<td>SNN</td>
								<td>FR1183</td>

							</tr>

							<tr id="6">
							
								<td>6</td>
								<td>Delta Airlines</td>
								<td>ATL</td>
								<td>SNN</td>
								<td>DL206</td>

							</tr>

							<tr id="7">
							
								<td>7</td>
								<td>American Airlines</td>
								<td>PHL</td>
								<td>SNN</td>
								<td>AA089</td>

							</tr>
							
							<tr id="8">
							
								<td>8</td>
								<td>Lufthansa</td>
								<td>FRA</td>
								<td>SNN</td>
								<td>LH8045</td>

							</tr>
						
							<tr id="9">
							
								<td>9</td>
								<td>United Airlines</td>
								<td>EWR</td>
								<td>SNN</td>
								<td>UA022</td>

							</tr>
							
							<tr id="10">
							
								<td>10</td>
								<td>Ryanair</td>
								<td>MAN</td>
								<td>SNN</td>
								<td>FR8159</td>

							</tr>
							
							<tr id="11">
								
								<td>11</td>
								<td>Ryanair</td>
								<td>FUE</td>
								<td>SNN</td>
								<td>FR3369</td>

							</tr>
				
						</table>
					</div>
				</div>
			</div>

			<!-- CREATE -->
			<div class="accordion-item">
				<h1 class="accordion-header" id="flush-headingTwo">
					<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
					Create Arrival
					</button>
				</h1>
				
				<div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
					
					<div class="accordion-body">
						If you would like to create an arrival please click the button below.<br><br>
						
						<div>
							<button id="button-showCreate" onclick="showCreate()" type="button" class="btn btn-info">Create Arrival</button><br/><br/>
						</div>
						
						<div id="createUpdateForm" style="display:none">
						
							<!-- spans are like divs but do not go onto a new line -->
							<h2><span id="createLabel">Create an</span> <span id="updateLabel">Update an</span> Arrival</h2>
							
							Id <input type="text" name="id"><br/>
							Airline <input type="text" name="airline"><br/>
							Origin <input type="text" name="origin"><br/>
							Destination <input type="text" name="destination"><br/>
							Flight Number <input type="text" name="flightnumber"><br/><br>	
							
							<span><button id="button-doCreate" onclick="doCreate()" type="button" class="btn btn-info">Create</button></span>
							<span><button id="button-doUpdate" onclick="doUpdate()" type="button" class="btn btn-info">Update</button></span>
							 <!-- "display:none" will make it hidden-->

						</div>
					</div>
				</div>
			</div>

			<!-- UPDATE -->
			<div class="accordion-item">
				<h1 class="accordion-header" id="flush-headingThree">
					<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
					Update Arrival
					</button>
				</h1>
				<div id="flush-collapseThree" class="accordion-collapse collapse" aria-labelledby="flush-headingThree" data-bs-parent="#accordionFlushExample">
					
					<div class="accordion-body">
						If you would like to update an arrival please click the button below.<br><br>
					
						<button onclick="showUpdate(this)">Update</button>

			
			
					</div>
				</div>
			</div>

			<!-- DELETE -->
			<div class="accordion-item">
				<h1 class="accordion-header" id="flush-headingFour">
					<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseFour" aria-expanded="false" aria-controls="flush-collapseFour">
					Delete Arrival
					</button>
				</h1>			
				<div id="flush-collapseFour" class="accordion-collapse collapse" aria-labelledby="flush-headingFour" data-bs-parent="#accordionFlushExample">
					<div class="accordion-body">If you would like to delete an arrival please click the button below.<br><br>
					
					<button onclick="">Delete</button>
					
					</div>
				</div>
			</div>
			
		</div>


	</body>
	<script>
	
	function showCreate(){
		document.getElementById("createUpdateForm").style.display = "block"
		
		document.getElementById("button-doCreate").style.display = "block"
		document.getElementById("button-doUpdate").style.display = "none"
		document.getElementById("createLabel").style.display = "inline"
		document.getElementById("updateLabel").style.display = "none"

		document.getElementById("button-showCreate").style.display = "none"
		document.getElementById("bookTable").style.display = "none"
		
	}
	
	function showUpdate(buttonElement){
		document.getElementById("createUpdateForm").style.display = "block"

		document.getElementById("button-doCreate").style.display = "none"
		document.getElementById("button-doUpdate").style.display = "block"
		document.getElementById("createLabel").style.display = "none"
		document.getElementById("updateLabel").style.display = "inline"

		document.getElementById("button-showCreate").style.display = "none"
		document.getElementById("bookTable").style.display = "none"

		rowElement= buttonElement.parentNode.parentNode
		book = getBookFromRow(rowElement)
		//console.log("updating")
		//console.log(book)
		populateFormWithBook(book)

	}

	function showViewall(){
		document.getElementById("createUpdateForm").style.display = "none"
	   
		document.getElementById("button-showCreate").style.display = "block"
		document.getElementById("bookTable").style.display = "block"
		
	}
	
	function clearForm(){
		var form = document.getElementById('createUpdateForm')

		form.querySelector('input[name="id"]').disabled = false
		form.querySelector('input[name="id"]').value  =''
		form.querySelector('input[name="airline"]').value=''
		form.querySelector('input[name="origin"]').value=''
		form.querySelector('input[name="destination"]').value=''
		form.querySelector('input[name="flightnumber"]').value=''
	}
	
	function getBookFromForm(){
		var form = document.getElementById('createUpdateForm')

		var book = {}
		book.id = form.querySelector('input[name="id"]').value
		book.airline = form.querySelector('input[name="airline"]').value
		book.origin = form.querySelector('input[name="origin"]').value
		book.destination = form.querySelector('input[name="destination"]').value
		book.flightnumebr = form.querySelector('input[name="flightnumber"]').value
		//console.log(JSON.stringify(book))
		return book
	}
	
	function populateFormWithBook(book){
		var form = document.getElementById('createUpdateForm')
		form.querySelector('input[name="id"]').disabled = true
		form.querySelector('input[name="id"]').value  = book.id
		form.querySelector('input[name="airline"]').value= book.airline
		form.querySelector('input[name="origin"]').value= book.origin
		form.querySelector('input[name="destination"]').value= book.destination
		form.querySelector('input[name="flightnumber"]').value= book.flightnumber
}

	function addBookToTable(book){
		var tableElement = document.getElementById('bookTable')
		var rowElement = tableElement.insertRow(-1)
		
		rowElement.setAttribute('id',book.id)
		
		var cell1 = rowElement.insertCell(0);
		cell1.innerHTML = book.id
		var cell2 = rowElement.insertCell(1);
		cell2.innerHTML = book.airline
		var cell3 = rowElement.insertCell(2);
		cell3.innerHTML = book.origin
		var cell4 = rowElement.insertCell(3);
		cell4.innerHTML = book.destination
		var cell5 = rowElement.insertCell(4);
		cell5.innerHTML = book.flightnumber
		var cell6 = rowElement.insertCell(5);
		cell6.innerHTML = '<button onclick="showUpdate(this)">Update</button>'
		var cell7 = rowElement.insertCell(6);
		cell7.innerHTML = '<button onclick=doDelete(this)>delete</button>'

	}
	
	function getBookFromRow(rowElement){
		var book ={}
		book.id  = rowElement.cells[0].firstChild.textContent
		book.airline = rowElement.cells[1].firstChild.textContent
		book.origin = rowElement.cells[2].firstChild.textContent
		book.destination = rowElement.cells[3].firstChild.textContent
		book.flightnumber = rowElement.cells[4].firstChild.textContent
		return book
	}
	
	function setBookInRow(rowElement, book){
		rowElement.cells[0].firstChild.textContent= book.id  
		rowElement.cells[1].firstChild.textContent= book.airline
		rowElement.cells[2].firstChild.textContent= book.origin
		rowElement.cells[3].firstChild.textContent= book.destination
		rowElement.cells[4].firstChild.textContent= book.flightnumber
}

	function doCreate(){
		console.log("creating a book")
		book = getBookFromForm()
		console.log(book)
		addBookToTable(book)
		showViewall()
		clearForm()
	}
	
	function doUpdate(){
		book= getBookFromForm()
		//console.log(book)
		var rowElement = document.getElementById(book.id)
		setBookInRow(rowElement, book)

		showViewall()
		clearForm()
	}
	
	function doDelete(buttonElement){
		console.log("in delete")
		var tableElement = document.getElementById('bookTable')
		var index = buttonElement.parentNode.parentNode.rowIndex;
		tableElement.deleteRow(index);

	}

		
	</script>

</html>